jQuery(function(r){let o={page:1,order:"DESC",loading:!1,perPage:henryProject.perPage||10},i=r("#entries-list"),s=r("#pagination"),a=r("#entry-form");var e=r("#sort-toggle");function l(){o.loading||(o.loading=!0,i.addClass("loading"),r.ajax({url:henryProject.ajaxUrl,type:"GET",data:{action:"henry_project_get_entries",nonce:henryProject.nonce,page:o.page,order:o.order},success:function(e){if(e.success){(a=e.data.entries).length?(i.html(a.map(e=>`
            <div class="henry-project-entry" data-entry-id="${e.id}">
                <div class="d-flex justify-content-between">
                    <div class="entry-content ${e.can_edit?"editable":""}"
                         ${e.can_edit?'contenteditable="true"':""}>
                        ${g(e.content)}
                    </div>
                    ${e.can_edit?`
                        <div class="henry-project-actions">
                            <button class="btn btn-sm btn-outline-danger delete-entry">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    `:""}
                </div>
                <small class="text-muted d-block mt-2">
                    By ${g(e.author.name)}
                    (${e.author.roles.join(", ")})
                    on ${new Date(e.date).toLocaleDateString()}
                </small>
            </div>
        `).join("")),r(".entry-content.editable").on("blur",c).on("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),r(this).blur())}),r(".delete-entry").on("click",d)):i.html(`
                <div class="alert alert-info">
                    No entries found.
                </div>
            `);var t=e.data.total_pages;if(t<=1)s.empty();else{var n=[];for(let e=1;e<=t;e++)n.push(`
                <li class="page-item ${e===o.page?"active":""}">
                    <button class="page-link" data-page="${e}">${e}</button>
                </li>
            `);s.html(`
            <nav aria-label="Entries pagination">
                <ul class="pagination">
                    ${n.join("")}
                </ul>
            </nav>
        `),s.find(".page-link").on("click",function(){o.page=parseInt(r(this).data("page")),l()})}}else u(e.data.message||"Error loading entries");var a},error:function(e,t,n){u("Error loading entries: "+n)},complete:function(){o.loading=!1,i.removeClass("loading")}}))}function c(e){var e=r(e.target),t=e.text().trim(),e=e.closest("[data-entry-id]").data("entryId");t?r.ajax({url:henryProject.ajaxUrl,type:"POST",data:{action:"henry_project_update_entry",nonce:henryProject.nonce,id:e,content:t},success:function(e){e.success?y("Entry updated successfully"):(u(e.data.message||"Error updating entry"),l())},error:function(e,t,n){u("Error updating entry: "+n),l()}}):l()}function d(e){if(confirm("Are you sure you want to delete this entry?")){let a=r(e.target).closest("[data-entry-id]");e=a.data("entryId");a.addClass("deleting"),r.ajax({url:henryProject.ajaxUrl,type:"POST",data:{action:"henry_project_delete_entry",nonce:henryProject.nonce,id:e},success:function(e){e.success?(l(),y("Entry deleted successfully")):(u(e.data.message||"Error deleting entry"),a.removeClass("deleting"))},error:function(e,t,n){u("Error deleting entry: "+n),a.removeClass("deleting")}})}}function u(e){t(e,"danger")}function y(e){t(e,"success")}function t(e,t){let n=r(`
            <div class="alert alert-${t} alert-dismissible fade show" role="alert">
                ${e}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `);i.before(n),setTimeout(()=>n.alert("close"),3e3)}function g(e){return r("<div>").text(e).html()}a.on("submit",function(t){t.preventDefault();let n=r("#entry-content");if(t=n.val().trim()){let e=a.find('[type="submit"]').prop("disabled",!0);r.ajax({url:henryProject.ajaxUrl,type:"POST",data:{action:"henry_project_create_entry",nonce:henryProject.nonce,content:t},success:function(e){e.success?(n.val(""),o.page=1,l(),y("Entry added successfully")):u(e.data.message||"Error adding entry")},error:function(e,t,n){u("Error adding entry: "+n)},complete:function(){e.prop("disabled",!1)}})}}),e.on("click",function(){o.order="DESC"===o.order?"ASC":"DESC",r(this).find("i").toggleClass("bi-sort-down bi-sort-up"),l()}),l()});