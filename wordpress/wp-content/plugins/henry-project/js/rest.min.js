document.addEventListener("DOMContentLoaded",function(){let r={page:1,order:"DESC",loading:!1,perPage:henryProject.perPage||10},i=document.getElementById("entries-list"),s=document.getElementById("pagination"),a=document.getElementById("entry-form"),e=document.getElementById("sort-toggle");async function l(){if(!r.loading){r.loading=!0,i.classList.add("loading");try{var e=await wp.apiFetch({path:`henry-project/v1/entries?page=${r.page}&order=${r.order}&per_page=`+r.perPage}),t=((a=e.entries).length?(i.innerHTML=a.map(e=>`
            <div class="henry-project-entry" data-entry-id="${e.id}">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="entry-content ${e.can_edit?"editable":""}"
                         ${e.can_edit?'contenteditable="true"':""}>
                        ${y(e.content)}
                    </div>
                    ${e.can_edit?`
                        <div class="henry-project-actions ms-3">
                            <button class="btn btn-sm btn-outline-danger delete-entry"
                                    title="Delete Entry">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    `:""}
                </div>
                <div class="entry-meta d-flex justify-content-between align-items-center mt-2">
                    <small class="text-muted">
                        By ${y(e.author.name)}
                        <span class="badge bg-secondary ms-1">${e.author.roles.join(", ")}</span>
                    </small>
                    <small class="text-muted">
                        ${new Date(e.date).toLocaleDateString()}
                    </small>
                </div>
            </div>
        `).join(""),document.querySelectorAll(".entry-content.editable").forEach(t=>{t.addEventListener("blur",o),t.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),t.blur())})}),document.querySelectorAll(".delete-entry").forEach(e=>{e.addEventListener("click",d)})):i.innerHTML=`
                <div class="alert alert-info">
                    No entries available for your role level.
                </div>
            `,e.total_pages);if(t<=1)s.innerHTML="";else{var n=[];for(let e=1;e<=t;e++)n.push(`
                <li class="page-item ${e===r.page?"active":""}">
                    <button class="page-link" data-page="${e}">${e}</button>
                </li>
            `);s.innerHTML=`
            <nav aria-label="Entries pagination">
                <ul class="pagination justify-content-center">
                    ${n.join("")}
                </ul>
            </nav>
        `,s.querySelectorAll(".page-link").forEach(e=>{e.addEventListener("click",e=>{r.page=parseInt(e.target.dataset.page),l()})})}}catch(e){c(e.message||"Error loading entries")}finally{r.loading=!1,i.classList.remove("loading")}var a}}async function o(e){var t=e.target.innerText.trim(),e=e.target.closest("[data-entry-id]").dataset.entryId;if(t)try{await wp.apiFetch({path:"henry-project/v1/entries/"+e,method:"PUT",data:{content:t}}),u("Entry updated successfully")}catch(e){c(e.message||"Error updating entry"),l()}else l()}async function d(t){if(confirm("Are you sure you want to delete this entry?")){var t=t.target.closest("[data-entry-id]"),e=t.dataset.entryId;t.classList.add("deleting");try{await wp.apiFetch({path:"henry-project/v1/entries/"+e,method:"DELETE"}),l(),u("Entry deleted successfully")}catch(e){c(e.message||"Error deleting entry"),t.classList.remove("deleting")}}}function c(e){t(e,"danger")}function u(e){t(e,"success")}function t(e,t){document.querySelectorAll(".alert").forEach(e=>e.remove());let n=document.createElement("div");n.className=`alert alert-${t} alert-dismissible fade show`,n.role="alert",n.innerHTML=`
            ${e}
            <button type="button" class="btn-close" onclick="this.parentElement.remove()" aria-label="Close">Ã—</button>
        `,i.insertAdjacentElement("beforebegin",n),setTimeout(()=>{n&&n.parentNode&&n.remove()},3e3)}function y(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}a.addEventListener("submit",async function(e){e.preventDefault();var t=(e=document.getElementById("entry-content")).value.trim(),n=a.querySelector('button[type="submit"]');if(t){n.disabled=!0;try{await wp.apiFetch({path:"henry-project/v1/entries",method:"POST",data:{content:t}}),e.value="",r.page=1,l(),u("Entry added successfully")}catch(e){c(e.message||"Error adding entry")}finally{n.disabled=!1}}}),e.addEventListener("click",()=>{r.order="DESC"===r.order?"ASC":"DESC",e.querySelector("i").classList.toggle("bi-sort-down"),e.querySelector("i").classList.toggle("bi-sort-up"),e.setAttribute("title","Sort "+("DESC"===r.order?"Oldest First":"Newest First")),l()}),e.setAttribute("title","Sort Newest First"),l()});