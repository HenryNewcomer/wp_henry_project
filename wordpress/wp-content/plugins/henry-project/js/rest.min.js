document.addEventListener("DOMContentLoaded",function(){let r={page:1,order:"DESC",loading:!1,perPage:henryProject.perPage||10},i=document.getElementById("entries-list"),s=document.getElementById("pagination");var e=document.getElementById("entry-form");let t=document.getElementById("sort-toggle");async function l(){if(!r.loading){r.loading=!0,i.classList.add("loading");try{var e=await wp.apiFetch({path:`henry-project/v1/entries?page=${r.page}&order=${r.order}&per_page=`+r.perPage}),t=((a=e.entries).length?(i.innerHTML=a.map(e=>`
            <div class="henry-project-entry" data-entry-id="${e.id}">
                <div class="d-flex justify-content-between">
                    <div class="entry-content ${e.can_edit?"editable":""}"
                         ${e.can_edit?'contenteditable="true"':""}>
                        ${u(e.content)}
                    </div>
                    ${e.can_edit?`
                        <div class="henry-project-actions">
                            <button class="btn btn-sm btn-outline-danger delete-entry">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    `:""}
                </div>
                <small class="text-muted d-block mt-2">
                    By ${u(e.author.name)}
                    (${e.author.roles.join(", ")})
                    on ${new Date(e.date).toLocaleDateString()}
                </small>
            </div>
        `).join(""),document.querySelectorAll(".entry-content.editable").forEach(t=>{t.addEventListener("blur",o),t.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),t.blur())})}),document.querySelectorAll(".delete-entry").forEach(e=>{e.addEventListener("click",d)})):i.innerHTML=`
                <div class="alert alert-info">
                    No entries found.
                </div>
            `,e.total_pages);if(t<=1)s.innerHTML="";else{var n=[];for(let e=1;e<=t;e++)n.push(`
                <li class="page-item ${e===r.page?"active":""}">
                    <button class="page-link" data-page="${e}">${e}</button>
                </li>
            `);s.innerHTML=`
            <nav aria-label="Entries pagination">
                <ul class="pagination">
                    ${n.join("")}
                </ul>
            </nav>
        `,s.querySelectorAll(".page-link").forEach(e=>{e.addEventListener("click",e=>{r.page=parseInt(e.target.dataset.page),l()})})}}catch(e){c(e.message||"Error loading entries")}finally{r.loading=!1,i.classList.remove("loading")}var a}}async function o(e){var t=e.target.innerText.trim(),e=e.target.closest("[data-entry-id]").dataset.entryId;if(t)try{await wp.apiFetch({path:"henry-project/v1/entries/"+e,method:"PUT",data:{content:t}}),n("Entry updated successfully")}catch(e){c(e.message||"Error updating entry"),l()}else l()}async function d(t){if(confirm("Are you sure you want to delete this entry?")){var t=t.target.closest("[data-entry-id]"),e=t.dataset.entryId;t.classList.add("deleting");try{await wp.apiFetch({path:"henry-project/v1/entries/"+e,method:"DELETE"}),l(),n("Entry deleted successfully")}catch(e){c(e.message||"Error deleting entry"),t.classList.remove("deleting")}}}function c(e){e=a(e,"danger");i.insertAdjacentElement("beforebegin",e)}function n(e){e=a(e,"success");i.insertAdjacentElement("beforebegin",e)}function a(e,t){let n=document.createElement("div");return n.className=`alert alert-${t} alert-dismissible fade show`,n.innerHTML=`
            ${e}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `,setTimeout(()=>{n.remove()},3e3),n}function u(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}e.addEventListener("submit",async function(e){e.preventDefault();var t=(e=document.getElementById("entry-content")).value.trim();if(t)try{await wp.apiFetch({path:"henry-project/v1/entries",method:"POST",data:{content:t}}),e.value="",r.page=1,l(),n("Entry added successfully")}catch(e){c(e.message||"Error adding entry")}}),t.addEventListener("click",()=>{r.order="DESC"===r.order?"ASC":"DESC",t.querySelector("i").classList.toggle("bi-sort-down"),t.querySelector("i").classList.toggle("bi-sort-up"),l()}),l()});